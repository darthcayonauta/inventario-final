<style media="screen">
  .formas{
    background:#EFEFEF;
    padding:5px;
  }
</style>

<div class="row">
  <div class="col-sm-2">
    Código
  </div>
  <div class="col-sm-10">
    <input type="text" name="" value="###codigo###"
           disabled="disabled" class="form-control">
    <input type="hidden"
            name="codigo-###id###" id="codigo-###id###"
            value="###codigo###">
  </div>
</div>
<br>
<div class="row">
  <div class="col-sm-2">
    Insumo/producto
  </div>
  <div class="col-sm-10">
    <input type="text" name="" value="###insumo###"
           disabled="disabled" class="form-control">
    <input type="hidden"
            name="insumo-###id###" id="insumo-###id###"
            value="###insumo###">
  </div>
</div>
<br>
<div class="row">
  <div class="col-sm-2">
    Cliente
  </div>
  <div class="col-sm-10">
    ###select-cliente###
  </div>
</div>
<br>
<div class="row">
  <div class="col-sm-2">
    Trabajo
  </div>
  <div class="col-sm-6">
    <div id="espacio-combo-trabajo-###id###">
      ###select-trabajo###
    </div>
  </div>
  <div class="col-sm-4">
    <button name="no-existe-trabajo-###id###"
            id="no-existe-trabajo-###id###"
            class="btn btn-secondary btn-sm"
            data-toggle="tooltip"
            title="Abrir / Cerrar Ingreso de Trabajo"
            >
            ¿ No existe el Trabajo ?
    </button>
  </div>
</div>
<div id="form-trabajo-###id###">
<br>
    <div class="row formas">
        <div class="col-sm-2">
          Nombre Trabajo
        </div>
        <div class="col-sm-6">
          <input  type="text"
                  name="nombre_trabajo-###id###"
                  id="nombre_trabajo-###id###"
                  placeholder="Ingrese Nombre de Trabajo"
                  class="form-control">
        </div>
        <div class="col-sm-4">
          <button  id="ingresa-trabajillo-###id###"
                  class="btn btn-sm btn-success"
          >
            Ingrese Trabajo
        </button>
        </div>
    </div>
</div>
<br>
<div class="row">
  <div class="col-sm-2">
    Lugar de Destino
  </div>
  <div class="col-sm-6">
    <div id="espacio-combo-destino-###id###">
      ###select-destino###
    </div>
  </div>
  <div class="col-sm-4">
    <button name="no-existe-destino-###id###"
            id="no-existe-destino-###id###"
            class="btn btn-secondary btn-sm"
            data-toggle="tooltip"
            title="Abrir / Cerrar Ingreso de Destino"
            >
            ¿ No existe el Destino ?
    </button>
  </div>
</div>
<div id="form-destino-###id###">
<br>
    <div class="row formas">
        <div class="col-sm-2">
          Nombre Destino
        </div>
        <div class="col-sm-6">
          <input  type="text"
                  name="nombre_destino-###id###"
                  id="nombre_destino-###id###"
                  placeholder="Ingrese Nombre de Destino"
                  class="form-control">
        </div>
        <div class="col-sm-4">
          <button  id="ingresa-destinillo-###id###"
                  class="btn btn-sm btn-success"
          >
            Ingrese Destino
        </button>
        </div>
    </div>
</div>
<br>
<div class="row">
  <div class="col-sm-2">
    Cantidad
  </div>
  <div class="col-sm-10">
    <input type="text" name="cantidad2" id="cantidad2-###id###"
            class="form-control" placeholder="Ingresar cantidad">
  </div>
</div>
<br>
<div class="row">
  <div class="col-sm-2">
    Comentarios
  </div>
  <div class="col-sm-10">
    <textarea name  ="comentarios-###id###"
              id    ="comentarios-###id###" rows="8" cols="80"
              class="form-control">
    </textarea>
  </div>
</div>
<br>
<!--
<div class="row">
  <div class="col-sm-2">
    Archivo
  </div>
  <div class="col-sm-10">
    <input type="file" name="archivo" id="archivo" class="form-control">
  </div>
</div>
-->
<br>
<div class="row">
  <div class="col-sm-12">
    <input type="hidden"
            name="id_user-###id###" id="id_user-###id###"
            value="###id_user###">
      <button class="btn btn-block btn-info" id="envia-egreso-###id###" data-dismiss="modal">
          <i class="far fa-save"></i>  Guardar
      </button>
  </div>
</div>
<br>


<div class="row">
  <div class="col-sm-12">
    <div id="notifica2-###id###"></div>
  </div>
</div>
<br>

<script>

  $('#ingresa-destinillo-###id###').on('click',()=>{

      let nombre_destino = $('#nombre_destino-###id###').val();
      let id_insumo      = "###id###";

      if( nombre_destino == '' )
      { alert( 'Debe ingresar un nombre de Destino' ); return false; }
      else{

        let data = { 'id':'ingresa_nombre_destino_from_egreso',
                     'nombre_destino':nombre_destino,
                     'id_insumo':id_insumo };

        ajx( '#espacio-combo-destino-###id###', data );
        $('#nombre_destino-###id###').val("");
        $('#form-destino-###id###').hide(400);
      }
  });


  $('#form-destino-###id###').hide();

  $('#no-existe-destino-###id###').on( 'click', ()=>{
      $('#form-destino-###id###').toggle(400);
  } );

  $('#ingresa-trabajillo-###id###').on('click',()=>{

      let nombre_trabajo = $('#nombre_trabajo-###id###').val();
      let id_insumo      = "###id###";

      if( nombre_trabajo == '' )
      { alert( 'Debe ingresar un nombre de trabajo' ); return false; }
      else{

        let data = { 'id':'ingresa_nombre_trabajo_from_egreso',
                     'nombre_trabajo':nombre_trabajo,
                     'id_insumo':id_insumo };

        ajx( '#espacio-combo-trabajo-###id###', data );
        $('#nombre_trabajo-###id###').val("");
        $('#form-trabajo-###id###').hide(400);
      }
  });

  $('#form-trabajo-###id###').hide();

  $('#no-existe-trabajo-###id###').on( 'click', ()=>{
      $('#form-trabajo-###id###').toggle(400);
  } );


  $('#envia-egreso-###id###').on('click' , ()=>{

    let id_user     = $('#id_user-###id###').val();
    let codigo      = $('#codigo-###id###').val();
    let insumo      = $('#insumo-###id###').val();
    let id_trabajo  = $('#id-trabajo-###id###').val();
    let id_cliente  = $('#id-cliente-###id###').val();
    let id_destino  = $('#id-destino-###id###').val();
    let cantidad    = $('#cantidad2-###id###').val();
    let comentarios = $('#comentarios-###id###').val();
    let id_inventario = '###id###';

    if( id_trabajo == '' || id_cliente == '' || id_destino == '' || cantidad == '' )
    {
      alert( 'los campos cliente, trabajo , destino y cantidad no pueden estar vacíos' );

      //alert( "cantidad :"+cantidad );
      return false;

    }else{
      if( !validaNumeroEntero( cantidad ) )
      {
          alert( 'La cantidad debe ser un número entero' );
          return false;

      }else{

        let data = {  'id_user'     : id_user,
                      'codigo'      : codigo,
                      'insumo'      : insumo,
                      'id_trabajo'  : id_trabajo,
                      'id_cliente'  : id_cliente,
                      'id_destino'  : id_destino,
                      'cantidad'    : cantidad,
                      'comentarios' : comentarios,
                      'id_inventario' : id_inventario,
                      'id'          : 'ingresaDataEgreso'};


        if( confirm( "Está seguro de ingresar los datos???" ) )
            ajx('#espacio-stock-###id###', data);

      }
    }
  }) ;
</script>
